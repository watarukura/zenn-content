---
title: "Zensicalã§GitHub Pageså…¬é–‹ã™ã‚‹"
emoji: "ğŸ¡"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Zensical"]
published: true
---

zenn.devã¨cosense(æ—§scrapbox)ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã®ã§ã™ãŒã€ã„ã–ã¨ã„ã†ã¨ãã¨ã®ãŸã‚ã«backupãŒæ¬²ã—ã„ãªã¨å”çªã«æ€ã„ã¾ã—ãŸã€‚  
markdownãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã„ã„æ„Ÿã˜ã«GitHub Pagesã§å…¬é–‹ã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„ã€ã¨æ€ã£ã¦èª¿ã¹ã¦ã„ãŸã¨ã“ã‚ã€[Zensical](https://zensical.org/docs/get-started/)ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’è¦‹ã¤ã‘ãŸã®ã§ã€ä½¿ã£ã¦ã¿ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

## Zensical

[Material for MkDocs](https://squidfunk.github.io/mkdocs-material/)ã®é–‹ç™ºãƒãƒ¼ãƒ ãŒä½œã£ãŸRustè£½ã®é™çš„ã‚µã‚¤ãƒˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã§ã™ã€‚

## å‡ºæ¥ä¸ŠãŒã£ãŸã‚‚ã®

- [zenn-content](https://watarukura.github.io/zenn-content/)
  - [GitHub repo](https://github.com/watarukura/zenn-content/)
- [cosense-content](https://watarukura.github.io/cosense-content/)
  - [GitHub repo](https://github.com/watarukura/cosense-content/)

## zenn-content

```shell
uv add zensical
uv zensical new .
```

ã‚ã¨ã¯ã€zensical.tomlã®projectæƒ…å ±ã‚’æ›¸ãã€project.themeã®custom_dirã‚’"article"ã«å¤‰æ›´ã—ã¾ã—ãŸã€‚  
articles/index.md ã«é©å½“ãªè¦‹å‡ºã—ãƒšãƒ¼ã‚¸ã‚’ä½œã£ã¦ã€`uv run zensical serve` ã™ã‚‹ã¨ã€localhost:8000 ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ãã¾ã™ã€‚

![img.png](./images/20260131_zensical_serve.png)

GitHub Pagesã§å…¬é–‹ã™ã‚‹æ–¹æ³•ã‚‚Zensicalã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚µãƒ³ãƒ—ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚  
<https://zensical.org/docs/publish-your-site/>
ã“ã‚Œã§ã€mainãƒ–ãƒ©ãƒ³ãƒã«pushã—ãŸã‚‰å…¬é–‹ã§ãã‚‹ä»•çµ„ã¿ã®å‡ºæ¥ä¸ŠãŒã‚Šã§ã™ã€‚

## cosense-content

cosenseã®æ–¹ã¯ä¸€æ—¦markdownã«å¤‰æ›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  
Pythonã§å¤‰æ›ç”¨ã®ã‚³ãƒ¼ãƒ‰ã‚’å…¬é–‹ã—ã¦ã„ã‚‹æ–¹ãŒã„ã‚‰ã—ãŸã®ã§ã€ã‚ã‚ŠãŒãŸãä½¿ã‚ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚  
<https://github.com/matsushinDB11/Scrapbox_to_md/blob/master/Scrapbox_to_Notion.py>

indentãŒ2ã ã¨zensicalãŒãƒ¬ãƒ™ãƒ«åˆ¤å®šã—ã¦ãã‚Œãªã„ã®ã§4ã«ã—ãŸã‚Šã€å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã‚‚indentã«ã—ãŸã‚Šã¨ã„ã£ãŸè»½ã„ä¿®æ­£ã‚’åŠ ãˆã¦ã„ã¾ã™ãŒã€ã»ã¨ã‚“ã©ãã®ã¾ã¾åˆ©ç”¨ã§ãã€å¤§å¤‰åŠ©ã‹ã‚Šã¾ã—ãŸã€‚  

å®šæœŸçš„ã«cosenseã®è¨˜äº‹ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„ã®ã§ã€æ—¥ä»˜æŒ‡å®šã§cosenseã®å†…éƒ¨APIã‚’å‘¼ã‚“ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚  
<https://scrapbox.io/help-jp/API>
>ã‚ãã¾ã§å†…éƒ¨APIã§ã™ã€‚APIã¯äºˆå‘Šãªãå¤‰æ›´ã‚’è¡Œã„ã¾ã™ã€‚
ã¨ã®ã“ã¨ãªã®ã§ã€å¤‰æ›´ã•ã‚ŒãŸã‚‰è¿½éšã—ãªã„ã¨ã§ã™ã­ã€‚
ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã–ã£ã¨æ›¸ã„ã¦ã€Codexã«ç›¸è«‡ã—ã¦ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³å‘¨ã‚Šã®æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¦ã‚‚ã‚‰ã„ã¾ã—ãŸã€‚

```shell
#!/usr/bin/env bash
set -euo pipefail
set -xv

PROJECT="watarukura"

usage() {
  echo "Usage: $0 [-d YYYY-MM-DD|--since YYYY-MM-DD] [--skip-download]" >&2
  exit 2
}

since_date=""
skip_download=0
while [[ $# -gt 0 ]]; do
  case "$1" in
    -d|--since)
      [[ $# -ge 2 ]] || usage
      since_date="$2"
      shift 2
      ;;
    --since=*)
      since_date="${1#*=}"
      shift
      ;;
    -h|--help)
      usage
      ;;
    --skip-download)
      skip_download=1
      shift
      ;;
    *)
      echo "Unknown option: $1" >&2
      usage
      ;;
  esac
done

since_epoch=""
if [[ -n "$since_date" ]]; then
  if date -j -f "%Y-%m-%d" "$since_date" "+%s" >/dev/null 2>&1; then
    since_epoch=$(date -j -f "%Y-%m-%d" "$since_date" "+%s")
  else
    since_epoch=$(date -d "$since_date" "+%s")
  fi
fi

title_filter='.pages[].title'
jq_args=()
if [[ -n "$since_epoch" ]]; then
  title_filter='.pages[] | select(.updated >= $since_epoch) | .title'
  jq_args=(--argjson since_epoch "$since_epoch")
fi

page=1
if [[ "$skip_download" -eq 0 ]]; then
  curl -sL "https://scrapbox.io/api/pages/$PROJECT?sort=updated" >"articles$page"
  count=$(jq -r .count "articles$page")
  limit=$(jq -r .limit "articles$page")
  if [[ "$count" == "null" || "$limit" == "null" ]]; then
    echo "Failed to read page metadata from scrapbox API." >&2
    exit 1
  fi
  while ((count > limit)); do
    count=$((count - limit))
    skip=$((page * limit))
    page=$((page + 1))
    curl -sL "https://scrapbox.io/api/pages/$PROJECT?sort=updated&skip=$skip" >"articles$page"
  done
fi

if [[ "$skip_download" -eq 0 ]]; then
  mkdir -p scrapbox
  cat articles* |
    jq -r "${jq_args[@]}" "$title_filter" |
    sed -e 's;/;%2F;g' -e 's/ /_/g' |
    while read -r title; do
      curl -sL "https://scrapbox.io/api/pages/$PROJECT/$title/text" >"scrapbox/$title".sb
    done
fi

mkdir -p markdown
cat articles* |
  jq -r "${jq_args[@]}" "$title_filter" |
  sed -e 's;/;%2F;g' -e 's/ /_/g' |
  while read -r title; do
    uv run sb2md.py "scrapbox/$title".sb >"markdown/$title".md
  done
```

ã§ã€ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’é€±æ¬¡ã§å®Ÿè¡Œã—ã¦ã€Pull Requestã‚’ä½œã‚‹GitHub Actionsã®workflowã‚’ä½œã‚Šã¾ã™ã€‚
é€±1å›ã€ç›´è¿‘1é€±é–“ã®æ›´æ–°åˆ†ã‚’å–ã£ã¦ãã¦ã€Pull Requestã‚’ä½œã‚Šã¾ã™ã€‚  
ãƒãƒ¼ã‚¸ã—ãŸã‚‰å…¬é–‹ã•ã‚Œã‚‹ã€ã¨ã„ã†ä»•çµ„ã¿ã§ã™ã€‚

```yaml
name: Weekly Cosense Update PR
on:
  schedule:
    - cron: "0 0 * * 2"
  workflow_dispatch:
permissions:
  contents: write
  pull-requests: write
jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2
        with:
          persist-credentials: false
      - uses: actions/setup-python@a309ff8b426b58ec0e2a45f0f869d46889d02405 # v6.2.0
        with:
          python-version: "3.13"
      - uses: astral-sh/setup-uv@61cb8a9741eeb8a550a1b8544337180c0fc8476b # v7.2.0
      - name: Fetch updated Cosense pages
        env:
          TZ: Asia/Tokyo
        run: |
          since_date=$(date -d "7 days ago" +%Y-%m-%d)
          bash scripts/download_cosense.bash --since "$since_date"
      - name: Create pull request
        uses: peter-evans/create-pull-request@c0f553fe549906ede9cf27b5156039d195d2ece0 # v8.1.0
        with:
          commit-message: "Update Cosense content (weekly)"
          title: "Update Cosense content (weekly)"
          body: |
            Automated weekly update for Cosense content.
          branch: "automation/weekly-cosense-update"
          delete-branch: true
```

## ã¾ã¨ã‚

ä»•çµ„ã¿ã¨ã—ã¦ã¯é›£ã—ã„ã‚‚ã®ã§ã¯ãªã„ã®ã§ã™ãŒã€è‡ªåˆ†ã®ãƒ†ãƒƒã‚¯ãƒ–ãƒ­ã‚°ã‚’æŒã¤ã“ã¨ã®å®‰å¿ƒæ„Ÿã¯ã‚ã‚Šã¾ã™ã­ã€‚  
ãƒ‡ã‚¶ã‚¤ãƒ³ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã¾ã¾ã ã£ãŸã‚Šã€ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã£ã½ã„ã¤ãã‚Šãªã®ã§ãƒ–ãƒ­ã‚°ã£ã½ãã—ãŸã„ã€ãªã©ã‚„ã‚ŠãŸã„ã“ã¨ã¯ã‚ã‚‹ã®ã§ç›†æ ½ã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚
